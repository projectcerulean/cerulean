# Build manifest for sourcehut (https://builds.sr.ht/~gullik/cerulean)
image: alpine/latest

packages:
  - curl

sources:
  - https://git.sr.ht/~gullik/cerulean

tasks:
  - check_asset_availability: |
      cd cerulean
      for file in $(find assets -type f | sort); do
        hash=$(cat $file)
        curl --head --silent --fail --max-time 30 --output /dev/null https://ipfs.io/ipfs/$hash \
          || curl --head --silent --fail --max-time 30 --output /dev/null https://gateway.pinata.cloud/ipfs/$hash \
          || curl --head --silent --fail --max-time 30 --output /dev/null https://cloudflare-ipfs.com/ipfs/$hash \
          || exit 1
      done
